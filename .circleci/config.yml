version: 2.1

orbs:
  python: circleci/python@1.2

workflows:
  build-and-test:
      jobs:
        - Build and Push:
            filters:
              branches:
                only: master

jobs:
  Build and Push:
    docker:
      - image: cimg/python:3.9
        auth:
          username: emmaogiji
          password: $DOCKERHUB_PASSWORD
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: pip
      - setup_remote_docker:
          version: 19.03.13

      # build and push Docker image
      - run: |
          TAG=$CIRCLE_BUILD_NUM
          docker build -t emmaogiji/mintelweather:$TAG . --build-arg location_key=$LOCATION_API_KEY --build-arg weather_key=$WEATHER_API_KEY
          echo $DOCKERHUB_PASSWORD | docker login -u emmaogiji --password-stdin
          docker push emmaogiji/mintelweather:$TAG
